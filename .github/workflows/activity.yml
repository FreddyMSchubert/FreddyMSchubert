name: ğŸ› ï¸ Test Activity Widget
on:
  workflow_dispatch:
  schedule:
    - cron: "0 * * * *"

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run the Activity Widget Action
        uses: FreddyMSchubert/github-activity-timeline@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          username: "FreddyMSchubert"
          max_items: "25"
          event_templates: >
            {
              "issues_opened":               "{{index}}. ğŸ› Issue [#{{payload.issue.number}}]({{payload.issue.html_url}}) opened by {{actor}}: â€œ{{payload.issue.title}}â€",
              "issues_closed":               "{{index}}. âœ… Issue [#{{payload.issue.number}}]({{payload.issue.html_url}}) closed by {{actor}}",
              "issue_commented":             "{{index}}. ğŸ’¬ {{actor}} commented on Issue [#{{payload.issue.number}}]({{payload.issue.html_url}}): â€œ{{payload.comment.body}}â€ ([view comment]({{payload.comment.html_url}}))",
              "pr_opened":                   "{{index}}. ğŸ†• PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}}) opened by {{actor}}: â€œ{{payload.pull_request.title}}â€",
              "pr_merged":                   "{{index}}. ğŸ¯ PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}}) merged by {{actor}}",
              "pr_closed":                   "{{index}}. âŒ PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}}) closed (no merge) by {{actor}}",
              "pr_review_approved":          "{{index}}. ğŸ‘ {{actor}} approved PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}})",
              "pr_review_changes_requested": "{{index}}. ğŸš© {{actor}} requested changes on PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}})",
              "pr_review_comment":           "{{index}}. ğŸ—£ {{actor}} commented on PR [#{{payload.pull_request.number}}]({{payload.pull_request.html_url}}) review ([view comment]({{payload.comment.html_url}}))",
              "push":                        "{{index}}. ğŸš€ {{actor}} pushed {{payload.commits.length}} commit(s) to [{{payload.ref.replace('refs/heads/','')}}]({{payload.compare}}): â€œ{{payload.commits.length ? payload.commits[payload.commits.length-1].message : '<no commit message available>'}}â€",
              "release":                     "{{index}}. ğŸ“¡ New release [{{payload.release.tag_name}}]({{payload.release.html_url}}) by {{actor}}: {{payload.release.name || 'no title'}}",
              "fork":                        "{{index}}. ğŸ´ {{actor}} forked [{{payload.repository.full_name}}]({{payload.repository.html_url}}) to [{{payload.forkee.full_name}}]({{payload.forkee.html_url}})",
              "public":                      "{{index}}. ğŸ¸ {{actor}} made [{{repo}}](https://github.com/{{repo}}) public"
            }

      - name: Commit updated README ğŸ“–
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          # only commit if there are changes
          git diff --cached --quiet || git commit -m "chore: update activity widget"

      - name: Push changes ğŸ”¼
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
